import"../chunks/DsnmJJEf.js";import{o as W,_ as Me,as as D,aC as x,u as ge,aa as e,at as d,aG as _,a5 as ye,a2 as Le,af as F,a6 as Pe,a4 as me,$ as He,ad as C,ae as B,aD as Se}from"../chunks/CYXQVpue.js";import{d as Ke,s as $}from"../chunks/q5wOSprp.js";import{b as Ve}from"../chunks/DOpaPJET.js";const pe=[...` 	
\r\f \v\uFEFF`];function Oe(l,i,t){var s=l==null?"":""+l;if(t){for(var a in t)if(t[a])s=s?s+" "+a:a;else if(s.length)for(var h=a.length,A=0;(A=s.indexOf(a,A))>=0;){var m=A+h;(A===0||pe.includes(s[A-1]))&&(m===s.length||pe.includes(s[m]))?s=(A===0?"":s.substring(0,A))+s.substring(m+1):A=m}}return s===""?null:s}function xe(l,i=!1){var t=i?" !important;":";",s="";for(var a in l){var h=l[a];h!=null&&h!==""&&(s+=" "+a+": "+h+t)}return s}function Ue(l,i){if(i){var t="",s,a;return Array.isArray(i)?(s=i[0],a=i[1]):s=i,s&&(t+=xe(s)),a&&(t+=xe(a,!0)),t=t.trim(),t===""?null:t}return String(l)}function ee(l,i,t,s,a,h){var A=l.__className;if(W||A!==t||A===void 0){var m=Oe(t,s,h);(!W||m!==l.getAttribute("class"))&&(m==null?l.removeAttribute("class"):l.className=m),l.__className=t}else if(h&&a!==h)for(var p in h){var T=!!h[p];(a==null||T!==!!a[p])&&l.classList.toggle(p,T)}return h}function te(l,i={},t,s){for(var a in t){var h=t[a];i[a]!==h&&(t[a]==null?l.style.removeProperty(a):l.style.setProperty(a,h,s))}}function De(l,i,t,s){var a=l.__style;if(W||a!==i){var h=Ue(i,s);(!W||h!==l.getAttribute("style"))&&(h==null?l.removeAttribute("style"):l.style.cssText=h),l.__style=i}else s&&(Array.isArray(s)?(te(l,t?.[0],s[0]),te(l,t?.[1],s[1],"important")):te(l,t,s));return s}const We="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAEdElEQVR4AdyYPWtUQRSGZwQt1VqwsRMMQRFTxC5qIYoIBjSilYGIlbU/wkoUtLHQiFaipFBS5hdY2FlapzbIep6z90zmzt6PmbubGJV5d+Z8v+/s3c3iIfeP//tvBIzkjYgh5oFdNZ72Dnjovlz75YCc46T0LOE9Xem8ml3xg4ByNgE4AkhqgyRZQznOdGnftrnmTyfGAvzqiyPu/K3vaU7NjhrpQAmyyzZoUauI+nY2gqMk6O3L7mIB2P7spXkVkSuEwVKoJEp3ag1S27ngk5KnIBWAL4AiEBw9ByPTt/e0qYWZD2rOyGgSoO9ClON+n3wdm7Uzt2KEa4EGg1zclm82vhTMjInzZEhOeHTkrKtJAIGaiIWFCyqCpgQNEIAMNmf2ElCb1jEDMNN6tZEn3iaA2IQInDRnZzAEOOeCfOri/NhnvXPJ06dLAPGaCBzABnE2xETMl7N//nLX3Ti17NjT/K6bt9w+AeQFEXYza09W7Q8e8WJA1nDtyhsHPv74oH1sRg55CnIEkDchAmeKrnfBCHPbEDbEPUrJU5srgFwVUd0MtuN5TkEAHzsw4kaYmyYegzxAbyDniW8b8TWuEgE0CI0hwI03gUSDESfffGlNHJOcMEPOvatUAA11ACQwmkAMUiCOp7bFyK/O2rs6Z21DBGQ1JglikAZm4+M8KwwWAKkUXaRi4mkddldtV2ywAJqORiMHlo/ddwAiBuLAiJufnVxALSBvKKYSEA+9eWZHxbxdvKN7HOMMUYuRi28WKBAQxvHTWQ3vx5+599vjH3vrF1eCn5vf/PbMAc7ej3Mtx2q8H/u10LnQu7J7tyEC3O3Fp9rYiHnv3crWegB+EpbmHjnAGV+c47133vvwF916kluCQQLiARBLceL6V/fg+eEaqCFv6fhVJW07/mlQKiC8xdwYH8im4T8/XXYbGxu1EIJqjsqgB70qky3MwOhDrgCajhgErClnCBjMz46IVw93XAz8gPzN7Q39KUIPfIAzkLPOk7135QigmTZ6t/XYGdQhLww0QKwPELd8dmmhy/qyq2P8EmaPzcnXHAFeymKED7H4gyAbfProPdeFphp8kZh4FmfCrcgRMFEMWYMEGWIQM2tZvrc+7FmVSdIQAWG49OIs2+6anzvnurCbGU70iBECOYdcATyLKXL6T+RUj8pMetE8R8CI7+8YFE6LpF8sqKh1joCJhgwXJ0NlC0u/ZoPVcuBZr+pDBrZBnGlfcbWvPgF6++3lIZJFPmTP8NAnQP/DN53Hd734+ODJNl785ulD0+2Pq4e/9gnI6Zz7LuX0Ks7JEVB7F5puP3cqz3lVn1vSm5cjgCYqomH4TG+/6l97NBnehVwB9KCxAXsw+YooPRTYQI3ClxIBcevB5HmMaARhg9h2Mexi5q8hAgaTN1qIAJVdTLqq022IAC08KC+lAvJufx/VlQjQP/H23LLvI8/WUSUCeFZrQESM1il7GCgR0ETjrwuaVkAqqlNQ/G5xTouH2LMWkHKoCZJgky3u4esPAAAA//8PuSOiAAAABklEQVQDAOQpdH9TChAxAAAAAElFTkSuQmCC",ze="data:image/png;base64,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",Ne="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAABtUlEQVR4AexW262DMAxNOwhrwBejMAB8syBfsAaLtLZVV1ZCmwY7QpV8FZPgV87xQdW9hz//cwJXC+gKuALKCfgnpBygutwVUI9Q2cAVUA5QXe4KqEeobFBLgQfgOjJw2y5rAgS6bdsgbZ5negfoFIfdbFkRIGAMOka3LAu5RJzyyal8WBB4CGBf4fR9H9BEPhL5WpMLWhDI3ZHEkQRaEjjh0BKg6f96L39KnI9KwFmlgpYA3H9+WahQQCABWjR9rrZWQUOAMRXvMYniBqLgEgJ4vxWJKgT2fQ9HhsClWZAwJcCgm6YJR8ZxSUJ7NiXAoBHUMAxBGvpkHN8tTEPgtm1bgoFBx4FP/lePW5z/67uGQHLHuq5hHEeyaZqCNPZjTlKocGgJvFUoAca52ukjby0B7EHWdV2Qhv8mSJMxPFORwcOCAKnwmiZB4l+beKcgPDAXDY6nv32opWVBABshkDcR/rWJdwSNBgWUD7t6WRFgIAQMQR4ZJFEcdrNlTYCBMdB457jZXouAGcBcIyeQm1DtuCtQe8K5/q5AbkK143UUqI1a9HcCYhiXHF2BS8YuLv17BZ4AAAD//4+CmpMAAAAGSURBVAMA7sawYcuQSOEAAAAASUVORK5CYIIA",Xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAADUElEQVR4AeyWPW4bMRCFKXepA1VOkSJtap1BgAQEgS8RqUiXKwRIlzOkTSlAZ9BZBFc5gMJvrFlwNxR/hpRiAzb4ln8zb97jUpbu3Av/u6aBkz+bEH7av13DgIheLBYuhJcu677v2loNIEoFMT6p6Pl87kLoug+WON9rY67j6r7FQFj4H+FTJWpmYkTDQi5dK+qtBsKCIl4F5qpqHEZ87IjHz6ubxcDp4cujFEIEQJQsVDzIIReQduYMDbGcRa2BQXyW2RBgMVFj4Kri1W+tiVIDNxFvMVFi4PTj4dHdH5X++j21qOkrZT8TOQMi3hP9l1ZiImVgJP7eW+BkfCeNu3o4HGTc8oADLuWgBrV0njORMqAc2f54rL9flpyYkGoDnFCMqMeahbvKQPhqewiOcdTWqDJAQQpYTorcFOCEOxUT20sZmH37/TaWM6zx4eNDOCxUDsiFI5V21jC7FJMycCnnWa2bDfDKezlp4TIZsNzVnFkrZ85A8DkYS6AgJ8cd5i7X/F8nlhxy4YBrzP40y91/onIGiEkCAcmAxGZLrtKWGJC38OHNH80Z+ksnNwQUDGIc1Co5fehLDBAngFgGwQMBX/2vVa4EVyPYig6JIZYccqdBsRrTmHBeamD2+dd7ySspsNvtXAxCkHgo97nWxf/9IUWpAcm5e/d0jbSQLPoHJ8mJcrIIX61WLgb2iCGWHJ86NOXUGsNGZlBlAC4toAVZ477+9N/aKpq1EMvl0gHdJ5YcjVEu5db1kr7GwOzT94/CGRZCiAqTzcQDE0DjydVw5TzXKLo+5NYYIN6E/X4/ysPEaKFhYjbAiXGCnGZJ/akJcsiFAy7mFtQaGK6RpRgmFLH82usDR60BchyFACcoCw0POOACFhqLgeIPmEFQNbfFALqqC5GUgYnTaiCj5XbbrwZud9bxSi1vYMZvG2j5YlIwT0Hj6Ik7c5juP/ktBsgXbDYbB5ggLAViiAWMW9FqQN7Cer0WHYhSbLdbF0LX6Qkmp/X04Wk1AIcAQTIoeNTE5uh6GJC3wGkiDLgLVdkDxAIfZr77PldaDwMQIWRkhJ8IISLCySG3Cb0MqAhEDUY45RA+SPZ93631NqDCVOi01/1u/bUMdBOYI3rxBv4CAAD//3MfRTEAAAAGSURBVAMA3M1DcMjGBaYAAAAASUVORK5CYIIA";class Ge{x=0;y=0;speed=5;fireRate=.2;fireTimer=0;hitboxRadius=5;playerImage;spriteWidth=48;spriteHeight=48;animationFrame=0;animationTimer=0;animationSpeed=.1;constructor(){this.playerImage=new Image,this.playerImage.src=ze}draw(i,t){this.animationTimer+=t,this.animationTimer>=this.animationSpeed&&(this.animationFrame=(this.animationFrame+1)%3,this.animationTimer=0),this.playerImage.complete&&i.drawImage(this.playerImage,0,this.animationFrame*this.spriteHeight,this.spriteWidth,this.spriteHeight,this.x-this.spriteWidth/2,this.y-this.spriteHeight/2,this.spriteWidth,this.spriteHeight)}}class Y{x;y;direction;owner;color;speed;size;constructor({x:i,y:t,direction:s,owner:a,color:h="#f6e05e",speed:A=7,size:m=5}){this.x=i,this.y=t,this.direction=s,this.owner=a,this.color=h,this.speed=A,this.size=m}update(i){this.x+=this.direction.x*this.speed*60*i,this.y+=this.direction.y*this.speed*60*i}draw(i){i.beginPath(),i.arc(this.x,this.y,this.size,0,Math.PI*2),i.fillStyle=this.color,i.fill(),i.closePath()}}class ie{x;y;health;scoreValue;width=48;height=48;color;speed=4;hitboxRadius=10;fireTimer=0;enemyImage;constructor({x:i,y:t,health:s,scoreValue:a,imageSrc:h,color:A="#e53e3e"}){this.x=i,this.y=t,this.health=s,this.scoreValue=a,this.color=A,this.enemyImage=new Image,this.enemyImage.src=h}update(i,t,s){this.y+=this.speed*60*i}draw(i){this.enemyImage.complete?i.drawImage(this.enemyImage,this.x-this.width/2,this.y-this.height/2,this.width,this.height):(i.beginPath(),i.rect(this.x-this.width/2,this.y-this.height/2,this.width,this.height),i.fillStyle=this.color,i.fill(),i.closePath())}}class ve extends ie{fireRate=1;constructor({x:i,y:t,health:s,scoreValue:a,color:h}){super({x:i,y:t,health:s,scoreValue:a,color:h,imageSrc:Ne})}}class we extends ie{fireRate=1.5;constructor({x:i,y:t,health:s,scoreValue:a,color:h}){super({x:i,y:t,health:s,scoreValue:a,color:h,imageSrc:Xe})}}class Ze extends ie{targetX;targetY;moveOffset={x:0,y:0};fireTimer=0;patterns=[{time:1,type:"spread",speed:4,moveOffset:{x:.5,y:-.5}},{time:2,type:"circular",speed:2,moveOffset:{x:-.5,y:.5}},{time:3,type:"spiral",speed:2,moveOffset:{x:.8,y:.8}},{time:4,type:"random",speed:6,moveOffset:{x:-.8,y:-.8}}];currentPatternIndex=0;patternTimer=0;width=48;height=48;hitboxRadius=25;speed=.5;maxHealth;constructor({x:i,y:t,health:s,scoreValue:a}){super({x:i,y:t,health:s,scoreValue:a,color:"#f56565",imageSrc:We}),this.targetX=i,this.targetY=t,this.maxHealth=s}update(i,t,s){const a=this.patterns[this.currentPatternIndex],h=(a.moveOffset.x+1)/2,A=(a.moveOffset.y+1)/2;this.targetX=h*(t-this.width),this.targetY=A*(s*.4-this.height),this.targetX+=this.width/2,this.targetY+=this.height/2,this.x+=(this.targetX-this.x)*this.speed*i,this.y+=(this.targetY-this.y)*this.speed*i,this.fireTimer+=i,this.patternTimer+=i}}function qe(l,i){d(i,!1)}var Je=ye('<link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&amp;display=swap" rel="stylesheet"/>'),je=ye(`<div class="bg-gray-900 text-white font-['M_PLUS_Rounded_1c'] flex flex-col justify-center items-center h-screen overflow-hidden"><div class="relative max-w-lg w-full h-full my-4 shadow-lg rounded-lg overflow-hidden"><canvas class="bg-black border-2 border-gray-600 w-full h-full touch-none"></canvas> <div class="absolute top-0 left-0 w-full flex justify-between p-4 box-border pointer-events-none z-10"><div class="text-xl font-bold p-2 bg-gray-700 rounded-lg shadow-lg"> </div> <div class="text-xl font-bold p-2 bg-gray-700 rounded-lg shadow-lg"> </div></div> <div><div class="h-full bg-red-500 transition-all duration-300"></div></div> <div><h1 class="text-4xl sm:text-6xl font-extrabold text-blue-400 mb-6">スマホで遊べるSTG</h1> <p class="text-lg sm:text-2xl font-semibold mb-8 text-gray-300">画面を指でなぞって移動。<br/> PCでは十字キーで操作。<br/> 弾は自動で発射されます。</p> <button class="px-8 py-4 bg-blue-500 hover:bg-blue-600 rounded-full text-xl sm:text-3xl font-bold transition-transform transform hover:scale-105 shadow-lg">ゲームスタート</button></div> <div><h2 class="text-6xl font-extrabold text-red-500 mb-4 animate-pulse">ゲームオーバー</h2> <p class="text-3xl font-semibold text-gray-300 mb-8"> </p> <button class="px-8 py-4 bg-green-500 hover:bg-green-600 rounded-full text-xl sm:text-3xl font-bold transition-transform transform hover:scale-105 shadow-lg">リスタート</button></div></div></div>`);function st(l,i){Me(i,!0);let t,s,a=x(0),h=x(3),A=x(!1),m=x(!1),p=D({}),T=x(!1),Q=x(!1),k=x(0);const Ie=4;let n=x(null),y=x(D([])),R=x(D([])),v=x(D([])),o=x(null),P=x(0),S=x(0);const z=[{time:1,type:"straight",x:50},{time:2,type:"straight",x:150},{time:3,type:"straight",x:250},{time:4,type:"straight",x:50},{time:5,type:"spread",x:150},{time:6,type:"spread",x:250},{time:7,type:"straight",x:100},{time:8,type:"spread",x:200},{time:9,type:"straight",x:150},{time:10,type:"straight",x:50},{time:11,type:"straight",x:150},{time:12,type:"spread",x:250},{time:13,type:"straight",x:50},{time:14,type:"spread",x:150},{time:15,type:"straight",x:250}],N=()=>{d(m,!0),d(A,!1),d(a,0),d(h,3),d(y,[],!0),d(R,[],!0),d(v,[],!0),d(o,null),d(P,0),d(S,0),d(Q,!1),d(k,0),e(n)||d(n,new Ge,!0),t&&(e(n).x=t.width/2,e(n).y=t.height-80),V=performance.now()};let K,V=0;ge(()=>{if(!e(m)||e(A))return;const u=E=>{if(!e(n))return;const g=(E-V)/1e3;if(V=E,e(T)){K=requestAnimationFrame(u);return}d(S,e(S)+g);const L=p.shift?e(n).speed/2:e(n).speed;if((p.arrowleft||p.a)&&(e(n).x-=L*60*g),(p.arrowright||p.d)&&(e(n).x+=L*60*g),(p.arrowup||p.w)&&(e(n).y-=L*60*g),(p.arrowdown||p.s)&&(e(n).y+=L*60*g),e(n).x=Math.max(e(n).hitboxRadius,Math.min(e(n).x,t.width-e(n).hitboxRadius)),e(n).y=Math.max(e(n).hitboxRadius,Math.min(e(n).y,t.height-e(n).hitboxRadius)),e(n).fireTimer+=g,e(n).fireTimer>=e(n).fireRate&&(e(R).push(new Y({x:e(n).x,y:e(n).y,direction:{x:0,y:-1},owner:"player"})),e(n).fireTimer=0),e(Q)&&(d(k,e(k)+g),e(k)>=Ie&&(d(Q,!1),d(k,0))),d(R,e(R).filter(r=>(r.update(g),r.y>-r.size)),!0),d(v,e(v).filter(r=>(r.update(g),r.y<t.height+r.size&&r.x>-r.size&&r.x<t.width+r.size)),!0),e(y).forEach(r=>{r.y+=r.speed*60*g,r.fireTimer+=g,r instanceof ve?r.fireTimer>=r.fireRate&&(e(v).push(new Y({x:r.x,y:r.y+r.height,direction:{x:0,y:1},owner:"enemy",color:"#a0aec0"})),r.fireTimer=0):r instanceof we&&r.fireTimer>=r.fireRate&&([-30,-15,0,15,30].forEach(I=>{const c=I*Math.PI/180,f=Math.sin(c),b=Math.cos(c);e(v).push(new Y({x:r.x,y:r.y+r.height,direction:{x:f,y:b},owner:"enemy",color:"#a0aec0"}))}),r.fireTimer=0)}),d(y,e(y).filter(r=>r.y<t.height+r.height),!0),e(P)<z.length){const r=z[e(P)];e(S)>=r.time&&(r.type==="straight"?e(y).push(new ve({x:r.x,y:-50,health:10,scoreValue:10})):r.type==="spread"&&e(y).push(new we({x:r.x,y:-50,health:15,scoreValue:20})),_(P))}if(e(P)>=z.length&&e(y).length===0&&!e(o)&&d(o,new Ze({x:t.width/2,y:100,health:500,scoreValue:1e3}),!0),e(o)){e(o).update(g,t.width,t.height);const r=e(o).patterns[e(o).currentPatternIndex];if(e(o).patternTimer>=r.time&&(e(o).currentPatternIndex=(e(o).currentPatternIndex+1)%e(o).patterns.length,e(o).patternTimer=0),e(o).fireTimer>=.5){const w=r.speed;switch(r.type){case"spread":for(let I=-2;I<=2;I++){const f=I*15*Math.PI/180,b=Math.sin(f),H=Math.cos(f);e(v).push(new Y({x:e(o).x,y:e(o).y+e(o).height/2,direction:{x:b,y:H},owner:"enemy",color:"#ecc94b",speed:w,size:8}))}break;case"circular":{for(let c=0;c<12;c++){const f=c/12*Math.PI*2,b=Math.sin(f)*w,H=Math.cos(f)*w;e(v).push(new Y({x:e(o).x,y:e(o).y+e(o).height/2,direction:{x:b,y:H},owner:"enemy",color:"#ecc94b",speed:w,size:6}))}break}case"spiral":{const c=e(o).fireTimer;for(let f=0;f<8;f++){const b=f/8*Math.PI*2+c,H=Math.sin(b)*w,ke=Math.cos(b)*w;e(v).push(new Y({x:e(o).x,y:e(o).y+e(o).height/2,direction:{x:H,y:ke},owner:"enemy",color:"#ecc94b",speed:w,size:6}))}break}case"random":Math.random()>.5&&e(v).push(new Y({x:e(o).x,y:e(o).y+e(o).height/2,direction:{x:Math.random()*2-1,y:1},owner:"enemy",color:"#ecc94b",speed:w,size:6}));break}e(o).fireTimer=0}}(()=>{if(!e(n))return;const r=new Set,w=new Set;let I=e(a);e(R).forEach(c=>{e(y).forEach(f=>{Math.hypot(c.x-f.x,c.y-f.y)<f.hitboxRadius+c.size&&(r.add(c),w.add(f),f.health-=1,f.health<=0&&(I+=f.scoreValue))}),e(o)&&Math.hypot(c.x-e(o).x,c.y-e(o).y)<e(o).hitboxRadius+c.size&&(r.add(c),e(o).health-=1,e(o).health<=0&&(I+=e(o).scoreValue))}),e(Q)||(e(v).forEach(c=>{if(!e(n))return;Math.hypot(c.x-e(n).x,c.y-e(n).y)<e(n).hitboxRadius+c.size&&(r.add(c),_(h,-1),e(h)<=0?d(A,!0):d(Q,!0))}),e(y).forEach(c=>{if(!e(n))return;Math.hypot(c.x-e(n).x,c.y-e(n).y)<e(n).hitboxRadius+c.hitboxRadius&&(_(h,-1),e(h)<=0?d(A,!0):d(Q,!0),w.add(c))})),d(R,e(R).filter(c=>!r.has(c)),!0),d(y,e(y).filter(c=>c.health>0&&!w.has(c)),!0),d(v,e(v).filter(c=>!r.has(c)),!0),d(a,I,!0)})(),s.clearRect(0,0,t.width,t.height),(!e(Q)||e(Q)&&Math.floor(e(k)*60/10)%2===0)&&e(n).draw(s,g);for(const r of e(R))r.draw(s);for(const r of e(y))r.draw(s);for(const r of e(v))r.draw(s);e(o)&&e(o).draw(s),K=requestAnimationFrame(u)};return K=requestAnimationFrame(u),()=>cancelAnimationFrame(K)});const se=u=>{p[u.key.toLowerCase()]=!0},re=u=>{p[u.key.toLowerCase()]=!1};let X=0,ae=x(!1);function Ee(u){if(!e(m)||e(A)){N();return}u.preventDefault(),d(ae,!0),X=u.touches[0].clientX}function be(u){if(!e(m)||e(A)||!e(n))return;u.preventDefault();const E=u.touches[0].clientX,g=E-X;e(n).x+=g,X=E}const ne=()=>{d(T,!0)},oe=()=>{d(T,!1),V=performance.now()};ge(()=>{if(e(n))return t&&(s=t.getContext("2d"),G(),e(n).x=t.width/2,e(n).y=t.height-80),window.addEventListener("keydown",se),window.addEventListener("keyup",re),window.addEventListener("resize",G),window.addEventListener("blur",ne),window.addEventListener("focus",oe),()=>{window.removeEventListener("keydown",se),window.removeEventListener("keyup",re),window.removeEventListener("resize",G),window.removeEventListener("blur",ne),window.removeEventListener("focus",oe)}});function G(){const u=document.querySelector(".relative.max-w-lg");u&&(t.width=u.offsetWidth,t.height=u.offsetHeight)}const Ce=Se(()=>e(o)?e(o).health/e(o).maxHealth*100:0);var M=je();Le(u=>{var E=Je();me(u,E)}),M.__touchstart=Ee,M.__touchmove=be,M.__touchend=[qe,ae];var he=C(M),le=C(he);Ve(le,u=>t=u,()=>t);var Z=F(le,2),q=C(Z),Be=C(q);B(q);var ce=F(q,2),Qe=C(ce);B(ce),B(Z);var O=F(Z,2);let de;var Re=C(O);let Ae;B(O);var U=F(O,2);let ue;var Fe=F(C(U),4);Fe.__click=N,B(U);var J=F(U,2);let fe;var j=F(C(J),2),Ye=C(j);B(j);var Te=F(j,2);Te.__click=N,B(J),B(he),B(M),Pe((u,E,g,L)=>{$(Be,`スコア: ${e(a)??""}`),$(Qe,`残機: ${e(h)??""}`),de=ee(O,1,"absolute top-2 left-1/2 -translate-x-1/2 w-4/5 md:w-3/5 h-6 bg-gray-700 rounded-full shadow-lg overflow-hidden",null,de,u),Ae=De(Re,"",Ae,E),ue=ee(U,1,"absolute inset-0 bg-black/70 flex flex-col justify-center items-center text-center z-20 p-4",null,ue,g),fe=ee(J,1,"absolute inset-0 bg-black/70 flex flex-col justify-center items-center text-center z-20 p-4",null,fe,L),$(Ye,`最終スコア: ${e(a)??""}`)},[()=>({hidden:!e(o)}),()=>({width:`${e(Ce)}%`}),()=>({hidden:e(m)}),()=>({hidden:!e(A)})]),me(l,M),He()}Ke(["touchstart","touchmove","touchend","click"]);export{st as component};
